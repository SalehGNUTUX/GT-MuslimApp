#!/bin/bash

# ÙƒØ´Ù Ù„ØºØ© Ø§Ù„Ù†Ø¸Ø§Ù…
LANG_CODE="${LANG:0:2}"
[[ "$LANG_CODE" != "ar" ]] && LANG_CODE="en"


#Ø§Ù„Ø¥Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
if ! command -v jq &>/dev/null; then
    echo "âŒ Ø§Ù„Ø£Ù…Ø± 'jq' ØºÙŠØ± Ù…ØªÙˆÙØ±. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ«Ø¨ÙŠØªÙ‡."
    exit 1
fi

# Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
clear
print_logo
print_intro
echo ""

# Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³Ø§Ø±Ø§Øª ÙˆØ§Ù„Ù…ØªØºÙŠØ±Ø§Øª
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
DATA_DIR="$SCRIPT_DIR/data"
CACHE_DIR="$SCRIPT_DIR/cache"
CONFIG_FILE="$SCRIPT_DIR/config.conf"
LANG_FILE="$SCRIPT_DIR/lang.conf"

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
mkdir -p "$DATA_DIR" "$CACHE_DIR"

# Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
QURAN_FILE="$DATA_DIR/quran.json"
AZKAR_FILE="$DATA_DIR/azkar.json"

# Ù…Ù„ÙØ§Øª Ø§Ù„Ø®Ø¨ÙŠØ¦Ø©
PRAYER_CACHE="$CACHE_DIR/prayer_times.json"
LOCATION_CACHE="$CACHE_DIR/location.json"

# Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
DEFAULT_CITY=""
DEFAULT_COUNTRY=""
PLAYER="mpv"
LANG="ar"

# Ø£Ù„ÙˆØ§Ù† Ù„Ù„ÙˆØ§Ø¬Ù‡Ø©
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# ==============================================
# Ø¯ÙˆØ§Ù„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„
# ==============================================

load_language() {
    if [[ -f "$LANG_FILE" ]]; then
        source "$LANG_FILE"
    fi
}

load_config() {
    load_language
    if [[ -f "$CONFIG_FILE" ]]; then
        source "$CONFIG_FILE"
    fi
}

save_config() {
    cat > "$CONFIG_FILE" << EOF
DEFAULT_CITY="$DEFAULT_CITY"
DEFAULT_COUNTRY="$DEFAULT_COUNTRY"
PLAYER="$PLAYER"
EOF
}

# ==============================================
# Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ±Ø¬Ù…Ø©
# ==============================================

t() {
    local key="$1"
    shift
    local args=("$@")

    case "$LANG" in
        "ar")
            case "$key" in

                "menu_title") echo "

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@B#@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@G?~^?B@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@G?~~~^:^?G@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@BPPPPPPPP57~!!7YY!^:^7PGPPPPPPPB@@@@@@@@@
@@@@@@@@@J~~~~~~~~~!!7JYY55Y7~^^^^^^^^^:?@@@@@@@@@
@@@@@@@@@Y777J??????JJJJ?JJY5Y??????J!^^J@@@@@@@@@
@@@@@@@@@5?7?YJJJJJYYJJ??7777JJJJJJYP?^^J@@@@@@@@@
@@@@@@@@@Y?7?JJJJYYJ7!!~!!7JJJJ????J5?^^?@@@@@@@@@
@@@@@@@BJ7?7?YY55J!~~~!7?Y5YJJ?????J5J^^^?B@@@@@@@
@@@@@B?!!77JY5PP?!~~!77?55YYYJ^~JJJJY5J!^:^?B@@@@@
@@@G?!!7?JJYYPGJ77!!!!75P5J77~^:~!!?JY55J!^:^7B@@@
@@@GJJJ?JJJJ5GGJ??!~~~7PPPP57!!~~7JYJJ?J5Y!!~!P@@@
@@@@@BPYJ?JY5GGYJY7^^^^YPPP5!?YJ!!YJJJJJ?77JG@@@@@
@@@@@@@BP5YJ5PBGYYY!:::^755YJYYYJ??JJY?7?JG@@@@@@@
@@@@@@@@@P5YJPPBGP5Y7^:..^!?JJJ?????5?7!J@@@@@@@@@
@@@@@@@@@PYYJYY5PGGP5YJ7~^^^~!!7???J5?7!Y@@@@@@@@@
@@@@@@@@@PYY?JJJJY5PPPPPP55YYYJJJJJJ5?7!Y@@@@@@@@@
@@@@@@@@@PYYJJJJJYYYJYYYYYY55YYJJJJJJ??!Y@@@@@@@@@
@@@@@@@@@BPGGGGGBBBG5Y???JJJJJ5GGGGGGGP5G@@@@@@@@@
@@@@@@@@@@@@@@@@@@@&BP5YJJJJYG&@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@&BPYJYG&@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@BB@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


  ğŸ•Œ GT-MuslimApp by GNUTUX ğŸ•Œ
ğŸ•Œ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø§Ù„Ù…Ø³Ù„Ù… Ù„Ù„Ø°ÙƒØ± ÙˆØ§Ù„ØµÙ„Ø§Ø©" ;;
                "menu_options") echo "1. Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…
2. ğŸ”Š ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ø§ÙˆØ©
3. ğŸ“¿ Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø°ÙƒØ§Ø±
4. ğŸ•‹ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©
5. ğŸŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
6. ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ
7. ğŸ” Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†
8. ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ±
9. âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
0. Ø®Ø±ÙˆØ¬" ;;
                "choose_option") echo "Ø§Ø®ØªØ± Ø®ÙŠØ§Ø±Ù‹Ø§: " ;;
                "invalid") echo "âŒ Ø®ÙŠØ§Ø± ØºÙŠØ± ØµØ­ÙŠØ­!" ;;
                "goodbye") echo "ğŸ¤² Ø¨Ø§Ø±Ùƒ Ø§Ù„Ù„Ù‡ ÙÙŠÙƒ ÙˆØ¥Ù„Ù‰ Ø§Ù„Ù„Ù‚Ø§Ø¡" ;;
                "bismillah") echo "ï·½" ;;
                "enter_sura") echo "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© (1-114): " ;;
                "enter_verse") echo "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ©: " ;;
                "choose_verses") echo "Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©:
1. Ø§Ù„Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©
2. Ø¢ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©
3. Ù…Ù† Ø¢ÙŠØ© Ø¥Ù„Ù‰ Ø¢ÙŠØ©" ;;
                "verse_range") echo "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰: " ;;
                "verse_range_end") echo "Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©: " ;;
                "loading") echo "â³ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„..." ;;
                "page_info") echo "ğŸ“„ Ø§Ù„ØµÙØ­Ø©: ${args[0]} | Ø§Ù„Ø¬Ø²Ø¡: ${args[1]}" ;;
                "no_data") echo "âŒ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: ${args[0]}" ;;
                "recitation_list") echo "ğŸ™ï¸ Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø§Ø±Ø¦:" ;;
                "choose_reciter") echo "Ø§Ø®ØªØ± Ø±Ù‚Ù… Ø§Ù„Ù‚Ø§Ø±Ø¦: " ;;
                "playing") echo "â–¶ï¸ Ø¬Ø§Ø±Ù Ø§Ù„ØªØ´ØºÙŠÙ„..." ;;
                "search_term") echo "Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«: " ;;
                "no_results") echo "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬" ;;
                "results_found") echo "âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${args[0]} Ù†ØªÙŠØ¬Ø©:" ;;
                "settings_menu") echo "âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª:
1. ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
2. ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹
3. Ø·Ø±ÙŠÙ‚Ø© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©
4. ØªØºÙŠÙŠØ± Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª
5. Ù…Ø³Ø­ Ø§Ù„Ø®Ø¨ÙŠØ¦Ø©
0. Ø±Ø¬ÙˆØ¹" ;;
                "select_lang") echo "Ø§Ø®ØªØ± Ø§Ù„Ù„ØºØ© (ar/en): " ;;
                "enter_city") echo "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: " ;;
                "enter_country") echo "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ù„Ø¯: " ;;
                "enter_method") echo "Ø£Ø¯Ø®Ù„ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨: " ;;
                "enter_player") echo "Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª (mpv, vlc, mplayer): " ;;
                "saved") echo "âœ… ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­" ;;
                "cache_cleared") echo "âœ… ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø®Ø¨ÙŠØ¦Ø© Ø¨Ù†Ø¬Ø§Ø­" ;;
                "statistics") echo "ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ±:" ;;
                "press_enter") echo "Ø§Ø¶ØºØ· Enter Ù„Ù„Ù…ØªØ§Ø¨Ø¹Ø©..." ;;
                "play_mode_menu") echo "ğŸ”„ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªØ´ØºÙŠÙ„:" ;;
                "listen_only") echo "ğŸ”Š Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ ÙÙ‚Ø·" ;;
                "read_only") echo "ğŸ“– Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·" ;;
                "read_listen") echo "ğŸ“–ğŸ”Š Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù…Ø¹Ø§Ù‹" ;;
                "choose_method") echo "Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø­Ø³Ø§Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©" ;;
"location_not_set") echo "Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø¹Ø¯" ;;
"enter_city_country") echo "ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø¨Ù„Ø¯" ;;
"prayer_times_from_cache") echo "Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© (Ù…Ù† Ø§Ù„Ø®Ø¨ÙŠØ¦Ø©)" ;;
"method") echo "Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨" ;;
"fajr") echo "Ø§Ù„ÙØ¬Ø±" ;;
"sunrise") echo "Ø§Ù„Ø´Ø±ÙˆÙ‚" ;;
"dhuhr") echo "Ø§Ù„Ø¸Ù‡Ø±" ;;
"asr") echo "Ø§Ù„Ø¹ØµØ±" ;;
"maghrib") echo "Ø§Ù„Ù…ØºØ±Ø¨" ;;
"isha") echo "Ø§Ù„Ø¹Ø´Ø§Ø¡" ;;
"cache_corrupted") echo "Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø¨ÙŠØ¦Ø© ØªØ§Ù„ÙØ©ØŒ Ø³ÙŠØªÙ… Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©" ;;
"fetching_prayer_times") echo "Ø¬Ø§Ø±Ù Ø¬Ù„Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ù…Ù† Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª" ;;
"no_server_response") echo "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…" ;;
"check_internet") echo "ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª" ;;
"invalid_server_response") echo "Ø§Ø³ØªØ¬Ø§Ø¨Ø© ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…" ;;
"server_error") echo "Ø®Ø·Ø£ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…" ;;
"message") echo "Ø§Ù„Ø±Ø³Ø§Ù„Ø©" ;;
"no_prayer_times") echo "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©" ;;
"prayer_times_fetched") echo "ØªÙ… Ø¬Ù„Ø¨ Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­" ;;
"connecting_to") echo "Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€" ;;
                *) echo "$key" ;;
            esac
            ;;
        "en")
            case "$key" in
                "menu_title") echo "

@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@B#@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@G?~^?B@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@G?~~~^:^?G@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@BPPPPPPPP57~!!7YY!^:^7PGPPPPPPPB@@@@@@@@@
@@@@@@@@@J~~~~~~~~~!!7JYY55Y7~^^^^^^^^^:?@@@@@@@@@
@@@@@@@@@Y777J??????JJJJ?JJY5Y??????J!^^J@@@@@@@@@
@@@@@@@@@5?7?YJJJJJYYJJ??7777JJJJJJYP?^^J@@@@@@@@@
@@@@@@@@@Y?7?JJJJYYJ7!!~!!7JJJJ????J5?^^?@@@@@@@@@
@@@@@@@BJ7?7?YY55J!~~~!7?Y5YJJ?????J5J^^^?B@@@@@@@
@@@@@B?!!77JY5PP?!~~!77?55YYYJ^~JJJJY5J!^:^?B@@@@@
@@@G?!!7?JJYYPGJ77!!!!75P5J77~^:~!!?JY55J!^:^7B@@@
@@@GJJJ?JJJJ5GGJ??!~~~7PPPP57!!~~7JYJJ?J5Y!!~!P@@@
@@@@@BPYJ?JY5GGYJY7^^^^YPPP5!?YJ!!YJJJJJ?77JG@@@@@
@@@@@@@BP5YJ5PBGYYY!:::^755YJYYYJ??JJY?7?JG@@@@@@@
@@@@@@@@@P5YJPPBGP5Y7^:..^!?JJJ?????5?7!J@@@@@@@@@
@@@@@@@@@PYYJYY5PGGP5YJ7~^^^~!!7???J5?7!Y@@@@@@@@@
@@@@@@@@@PYY?JJJJY5PPPPPP55YYYJJJJJJ5?7!Y@@@@@@@@@
@@@@@@@@@PYYJJJJJYYYJYYYYYY55YYJJJJJJ??!Y@@@@@@@@@
@@@@@@@@@BPGGGGGBBBG5Y???JJJJJ5GGGGGGGP5G@@@@@@@@@
@@@@@@@@@@@@@@@@@@@&BP5YJJJJYG&@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@&BPYJYG&@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@BB@@@@@@@@@@@@@@@@@@@@@@@@
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@


  ğŸ•Œ GT-MuslimApp by GNUTUX ğŸ•Œ
ğŸ•Œ Muslim App for Dhikr and Prayer" ;;
                "menu_options") echo "1. Read Quran
2. ğŸ”Š Play Recitation
3. ğŸ“¿ Show Dhikr
4. ğŸ•‹ Prayer Times
5. ğŸŒ Location Info
6. ğŸ—“ï¸ Hijri Date
7. ğŸ” Search Quran
8. ğŸ“Š Surah Statistics
9. âš™ï¸ Settings
0. Exit" ;;
                "choose_option") echo "Choose an option: " ;;
                "invalid") echo "âŒ Invalid option!" ;;
                "goodbye") echo "ğŸ¤² May Allah bless you, goodbye" ;;
                "bismillah") echo "In the name of Allah, the Most Gracious, the Most Merciful" ;;
                "enter_sura") echo "Enter Surah number (1-114): " ;;
                "enter_verse") echo "Enter verse number: " ;;
                "choose_verses") echo "Choose reading type:
1. Full Surah
2. Specific verse
3. Range of verses" ;;
                "verse_range") echo "Enter first verse number: " ;;
                "verse_range_end") echo "Enter last verse number: " ;;
                "loading") echo "â³ Loading..." ;;
                "page_info") echo "ğŸ“„ Page: ${args[0]} | Part: ${args[1]}" ;;
                "no_data") echo "âŒ Data file not found: ${args[0]}" ;;
                "recitation_list") echo "ğŸ™ï¸ Choose reciter:" ;;
                "choose_reciter") echo "Choose reciter number: " ;;
                "playing") echo "â–¶ï¸ Playing..." ;;
                "search_term") echo "Enter search term: " ;;
                "no_results") echo "âŒ No results found" ;;
                "results_found") echo "âœ… Found ${args[0]} results:" ;;
                "settings_menu") echo "âš™ï¸ Settings:
1. Change language
2. Set location
3. Prayer calculation method
4. Change audio player
5. Clear cache
0. Back" ;;
                "select_lang") echo "Choose language (ar/en): " ;;
                "enter_city") echo "Enter city name: " ;;
                "enter_country") echo "Enter country name: " ;;
                "enter_method") echo "Enter calculation method: " ;;
                "enter_player") echo "Enter audio player name (mpv, vlc, mplayer): " ;;
                "saved") echo "âœ… Saved successfully" ;;
                "cache_cleared") echo "âœ… Cache cleared successfully" ;;
                "statistics") echo "ğŸ“Š Surah Statistics:" ;;
                "press_enter") echo "Press Enter to continue..." ;;
                "play_mode_menu") echo "ğŸ”„ Select play mode:" ;;
                "listen_only") echo "ğŸ”Š Listen only" ;;
                "read_only") echo "ğŸ“– Read only" ;;
                "read_listen") echo "ğŸ“–ğŸ”Š Read and listen" ;;
                "choose_method") echo "Choose prayer times calculation method" ;;
"location_not_set") echo "Location not set" ;;
"enter_city_country") echo "Please enter city and country" ;;
"prayer_times_from_cache") echo "Prayer times (from cache)" ;;
"method") echo "Calculation method" ;;
"fajr") echo "Fajr" ;;
"sunrise") echo "Sunrise" ;;
"dhuhr") echo "Dhuhr" ;;
"asr") echo "Asr" ;;
"maghrib") echo "Maghrib" ;;
"isha") echo "Isha" ;;
"cache_corrupted") echo "Cache data corrupted, fetching new data" ;;
"fetching_prayer_times") echo "Fetching prayer times from internet" ;;
"no_server_response") echo "No response from server" ;;
"check_internet") echo "Check internet connection" ;;
"invalid_server_response") echo "Invalid server response" ;;
"server_error") echo "Server error" ;;
"message") echo "Message" ;;
"no_prayer_times") echo "No prayer times found" ;;
"prayer_times_fetched") echo "Prayer times fetched successfully" ;;
"connecting_to") echo "Connecting to" ;;
                *) echo "$key" ;;
            esac
            ;;
    esac
}

# ==============================================
# ÙØ­Øµ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
# ==============================================

check_dependencies() {
    local missing_deps=()

    local required_tools=("jq" "curl")
    for tool in "${required_tools[@]}"; do
        if ! command -v "$tool" &>/dev/null; then
            missing_deps+=("$tool")
        fi
    done

    local audio_players=("mpv" "vlc" "mplayer" "cvlc")
    local player_found=false
    for player in "${audio_players[@]}"; do
        if command -v "$player" &>/dev/null; then
            PLAYER="$player"
            player_found=true
            break
        fi
    done

    if [[ "$player_found" == false ]]; then
        missing_deps+=("audio player (mpv/vlc/mplayer)")
    fi

    if [[ ${#missing_deps[@]} -gt 0 ]]; then
        echo "âŒ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©:"
        printf '%s\n' "${missing_deps[@]}"
        echo ""
        echo "Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø¹Ù„Ù‰ Ubuntu/Debian:"
        echo "sudo apt update && sudo apt install jq curl mpv"
        echo ""
        echo "Ù„ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø¹Ù„Ù‰ CentOS/RHEL:"
        echo "sudo yum install jq curl mpv"
        exit 1
    fi
}

# ==============================================
# ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†
# ==============================================

download_quran_data() {
    if [[ ! -f "$QURAN_FILE" ]]; then
        echo "ğŸ“¥ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…..."

        cat > "$QURAN_FILE" << 'EOF'
{
  "data": {
    "surahs": [
      {
        "number": 1,
        "name": "Ø§Ù„ÙØ§ØªØ­Ø©",
        "englishName": "Al-Fatiha",
        "ayahs": [
          {"number": 1, "numberInSurah": 1, "text": "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù"},
          {"number": 2, "numberInSurah": 2, "text": "Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù"},
          {"number": 3, "numberInSurah": 3, "text": "Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù"},
          {"number": 4, "numberInSurah": 4, "text": "Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù"},
          {"number": 5, "numberInSurah": 5, "text": "Ø¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙØ¥ÙÙŠÙÙ‘Ø§ÙƒÙ Ù†ÙØ³Ù’ØªÙØ¹ÙÙŠÙ†Ù"},
          {"number": 6, "numberInSurah": 6, "text": "Ø§Ù‡Ù’Ø¯ÙÙ†ÙØ§ Ø§Ù„ØµÙÙ‘Ø±ÙØ§Ø·Ù Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙÙ‚ÙÙŠÙ…Ù"},
          {"number": 7, "numberInSurah": 7, "text": "ØµÙØ±ÙØ§Ø·Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù Ø£ÙÙ†Ù’Ø¹ÙÙ…Ù’ØªÙ Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙÙ„ÙÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙÙ„ÙØ§ Ø§Ù„Ø¶ÙÙ‘Ø§Ù„ÙÙ‘ÙŠÙ†Ù"}
        ]
      },
      {
        "number": 2,
        "name": "Ø§Ù„Ø¨Ù‚Ø±Ø©",
        "englishName": "Al-Baqara",
        "ayahs": [
          {"number": 8, "numberInSurah": 1, "text": "Ø§Ù„Ù…"},
          {"number": 9, "numberInSurah": 2, "text": "Ø°ÙÙ°Ù„ÙÙƒÙ Ø§Ù„Ù’ÙƒÙØªÙØ§Ø¨Ù Ù„ÙØ§ Ø±ÙÙŠÙ’Ø¨Ù Û› ÙÙÙŠÙ‡Ù Û› Ù‡ÙØ¯Ù‹Ù‰ Ù„ÙÙ‘Ù„Ù’Ù…ÙØªÙÙ‘Ù‚ÙÙŠÙ†Ù"},
          {"number": 10, "numberInSurah": 3, "text": "Ø§Ù„ÙÙ‘Ø°ÙÙŠÙ†Ù ÙŠÙØ¤Ù’Ù…ÙÙ†ÙÙˆÙ†Ù Ø¨ÙØ§Ù„Ù’ØºÙÙŠÙ’Ø¨Ù ÙˆÙÙŠÙÙ‚ÙÙŠÙ…ÙÙˆÙ†Ù Ø§Ù„ØµÙÙ‘Ù„ÙØ§Ø©Ù ÙˆÙÙ…ÙÙ…ÙÙ‘Ø§ Ø±ÙØ²ÙÙ‚Ù’Ù†ÙØ§Ù‡ÙÙ…Ù’ ÙŠÙÙ†ÙÙÙ‚ÙÙˆÙ†Ù"}
        ]
      },
      {
        "number": 114,
        "name": "Ø§Ù„Ù†Ø§Ø³",
        "englishName": "An-Nas",
        "ayahs": [
          {"number": 6236, "numberInSurah": 1, "text": "Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù"},
          {"number": 6237, "numberInSurah": 2, "text": "Ù…ÙÙ„ÙÙƒÙ Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù"},
          {"number": 6238, "numberInSurah": 3, "text": "Ø¥ÙÙ„ÙÙ°Ù‡Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù"},
          {"number": 6239, "numberInSurah": 4, "text": "Ù…ÙÙ† Ø´ÙØ±ÙÙ‘ Ø§Ù„Ù’ÙˆÙØ³Ù’ÙˆÙØ§Ø³Ù Ø§Ù„Ù’Ø®ÙÙ†ÙÙ‘Ø§Ø³Ù"},
          {"number": 6240, "numberInSurah": 5, "text": "Ø§Ù„ÙÙ‘Ø°ÙÙŠ ÙŠÙÙˆÙØ³Ù’ÙˆÙØ³Ù ÙÙÙŠ ØµÙØ¯ÙÙˆØ±Ù Ø§Ù„Ù†ÙÙ‘Ø§Ø³Ù"},
          {"number": 6241, "numberInSurah": 6, "text": "Ù…ÙÙ†Ù Ø§Ù„Ù’Ø¬ÙÙ†ÙÙ‘Ø©Ù ÙˆÙØ§Ù„Ù†ÙÙ‘Ø§Ø³Ù"}
        ]
      }
    ]
  }
}
EOF

        echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠ"
        echo "ğŸ’¡ Ù„Ø§Ø­Ù‚Ø§Ù‹ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"
        return 0
    fi
}

# ==============================================
# Ø¯ÙˆØ§Ù„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù‚Ø±Ø¢Ù†
# ==============================================

read_quran() {
    if [[ ! -f "$QURAN_FILE" ]]; then
        if ! download_quran_data; then
            return 1
        fi
    fi

    t enter_sura
    read sura_num

    if [[ ! "$sura_num" =~ ^[0-9]+$ ]] || [[ $sura_num -lt 1 ]] || [[ $sura_num -gt 114 ]]; then
        t invalid
        return 1
    fi

    local surah_data=$(jq --argjson num "$sura_num" '.data.surahs[] | select(.number == $num)' "$QURAN_FILE" 2>/dev/null)

    if [[ -z "$surah_data" ]]; then
        echo "âŒ Ø§Ù„Ø³ÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©"
        echo "ğŸ’¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© ÙÙ‚Ø· ÙƒÙ…Ø«Ø§Ù„"
        return 1
    fi

    local surah_name=$(echo "$surah_data" | jq -r '.name')

    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    t bismillah
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“– $surah_name"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    t choose_verses
    read verse_choice

    case $verse_choice in
        1) read_full_surah "$surah_data" ;;
        2) read_specific_verse "$sura_num" ;;
        3) read_verse_range "$surah_data" ;;
        *) t invalid ;;
    esac
}

read_full_surah() {
    local surah_data="$1"

    echo "$surah_data" | jq -r '.ayahs[] | "ï´¿ \(.text) ï´¾ (\(.numberInSurah))"' | while IFS= read -r verse; do
        echo "$verse"
        echo ""
        sleep 0.5
    done
}

read_specific_verse() {
    local sura_num="$1"

    t enter_verse
    read verse_num

    if [[ ! "$verse_num" =~ ^[0-9]+$ ]]; then
        t invalid
        return 1
    fi

    local verse_data=$(jq --argjson snum "$sura_num" --argjson vnum "$verse_num" '
        .data.surahs[] | select(.number == $snum) | .ayahs[] | select(.numberInSurah == $vnum)
    ' "$QURAN_FILE" 2>/dev/null)

    if [[ -z "$verse_data" ]]; then
        echo "âŒ Ø§Ù„Ø¢ÙŠØ© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©"
        return 1
    fi

    local verse_text=$(echo "$verse_data" | jq -r '.text')

    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    t bismillah
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ï´¿ $verse_text ï´¾"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}

read_verse_range() {
    local surah_data="$1"

    t verse_range
    read start_verse
    t verse_range_end
    read end_verse

    if [[ ! "$start_verse" =~ ^[0-9]+$ ]] || [[ ! "$end_verse" =~ ^[0-9]+$ ]]; then
        t invalid
        return 1
    fi

    if [[ $start_verse -gt $end_verse ]]; then
        echo "âŒ Ø±Ù‚Ù… Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©"
        return 1
    fi

    echo "$surah_data" | jq -r --argjson start "$start_verse" --argjson end "$end_verse" '
        .ayahs[] | select(.numberInSurah >= $start and .numberInSurah <= $end) |
        "ï´¿ \(.text) ï´¾ (\(.numberInSurah))"
    ' | while IFS= read -r verse; do
        echo "$verse"
        echo ""
        sleep 0.5
    done
}

# ==============================================
# ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ø§ÙˆØ© Ù…Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©
# ==============================================

play_recitation() {
    t enter_sura
    read sura_num

    if [[ ! "$sura_num" =~ ^[0-9]+$ ]] || [[ $sura_num -lt 1 ]] || [[ $sura_num -gt 114 ]]; then
        t invalid
        return 1
    fi

    local formatted_sura=$(printf "%03d" "$sura_num")

    # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø±Ø¦ÙŠÙ† Ù…Ø­Ø¯Ø«Ø© ÙˆÙ…ÙˆØ«ÙˆÙ‚Ø©
    declare -A reciters=(
        ["Ø¹Ø¨Ø¯ Ø§Ù„Ø¨Ø§Ø³Ø· Ø¹Ø¨Ø¯ Ø§Ù„ØµÙ…Ø¯"]="https://server8.mp3quran.net/basit/$formatted_sura.mp3"
    ["Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø³Ø¯ÙŠØ³"]="https://server11.mp3quran.net/sds/$formatted_sura.mp3"
    ["Ø³Ø¹Ø¯ Ø§Ù„ØºØ§Ù…Ø¯ÙŠ"]="https://server5.mp3quran.net/s_gmd/$formatted_sura.mp3"

    # Ù…Ù‚Ø±Ø¦ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠÙŠÙ† Ù…Ø¹ Ø±ÙˆØ§Ø¨Ø· Ù…Ø®ØªØ¨Ø±Ø©
    ["Ù…Ø´Ø§Ø±ÙŠ Ø±Ø§Ø´Ø¯ Ø§Ù„Ø¹ÙØ§Ø³ÙŠ"]="https://server8.mp3quran.net/afs/$formatted_sura.mp3"
    ["Ù…Ø§Ù‡Ø± Ø§Ù„Ù…Ø¹ÙŠÙ‚Ù„ÙŠ"]="https://server12.mp3quran.net/maher/$formatted_sura.mp3"
    ["Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø¬Ù…ÙŠ"]="https://server10.mp3quran.net/ajm/$formatted_sura.mp3"
    ["Ù…Ø­Ù…Ø¯ ØµØ¯ÙŠÙ‚ Ø§Ù„Ù…Ù†Ø´Ø§ÙˆÙŠ"]="https://server10.mp3quran.net/minsh/$formatted_sura.mp3"
    ["Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø¨ØµÙØ±"]="https://server7.mp3quran.net/basfer/$formatted_sura.mp3"
    ["ÙØ§Ø±Ø³ Ø¹Ø¨Ø§Ø¯"]="https://server8.mp3quran.net/frs_a/$formatted_sura.mp3"
    ["Ù…Ø­Ù…Ø¯ Ø£ÙŠÙˆØ¨"]="https://server8.mp3quran.net/ayyub/$formatted_sura.mp3"
    ["Ø¹Ø¨Ø¯ Ø§Ù„ÙˆÙ„ÙŠ Ø§Ù„Ø£Ø±ÙƒØ§Ù†ÙŠ"]="https://server11.mp3quran.net/arkani/$formatted_sura.mp3"
    ["ÙŠØ§Ø³Ø± Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ"]="https://server11.mp3quran.net/yasser/$formatted_sura.mp3"
    ["Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø·Ø§Ù…ÙŠ"]="https://server10.mp3quran.net/qatami/$formatted_sura.mp3"
    ["Ø¨Ù†Ø¯Ø± Ø¨Ù„ÙŠÙ„Ø©"]="https://server12.mp3quran.net/baleela/$formatted_sura.mp3"
    ["Ù‡Ø§Ù†ÙŠ Ø§Ù„Ø±ÙØ§Ø¹ÙŠ"]="https://server10.mp3quran.net/rifai/$formatted_sura.mp3"
    ["Ø®Ø§Ù„Ø¯ Ø§Ù„Ø¬Ù„ÙŠÙ„"]="https://server11.mp3quran.net/khalid_al_jaleel/$formatted_sura.mp3"
    ["Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¬Ù‡Ù†ÙŠ"]="https://server8.mp3quran.net/jhn/$formatted_sura.mp3"
    ["Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ø­ÙŠØ³Ù†ÙŠ"]="https://server12.mp3quran.net/mohsen/$formatted_sura.mp3"
    ["ØªÙˆÙÙŠÙ‚ Ø§Ù„ØµØ§ÙŠØº"]="https://server10.mp3quran.net/tawfeeq/$formatted_sura.mp3"
    ["Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡ ÙƒØ§Ù…Ù„"]="https://server7.mp3quran.net/kam/$formatted_sura.mp3"
    ["ÙˆØ¯ÙŠØ¹ Ø§Ù„ÙŠÙ…Ù†ÙŠ"]="https://server8.mp3quran.net/wadee3/$formatted_sura.mp3"
    ["Ø¹Ù„ÙŠ Ø§Ù„Ø­Ø°ÙŠÙÙŠ"]="https://server8.mp3quran.net/hudhaify/$formatted_sura.mp3"
    ["Ø¥Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø§Ù„Ø£Ø®Ø¶Ø±"]="https://server10.mp3quran.net/ibrahim_akhdar/$formatted_sura.mp3"
    ["Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¨Ø±Ø§Ùƒ"]="https://server12.mp3quran.net/brak/$formatted_sura.mp3"
    ["Ø£ÙƒØ±Ù… Ø§Ù„Ø¹Ù„Ø§Ù‚Ù…ÙŠ"]="https://server11.mp3quran.net/alaqmi/$formatted_sura.mp3"
    )

    # Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù‚Ø±Ø¦ÙŠÙ†
    t recitation_list
    local index=1
    declare -a reciter_options
    for reciter in "${!reciters[@]}"; do
        echo "$index. $reciter"
        reciter_options[$index]="$reciter"
        ((index++))
    done

    t choose_reciter
    read reciter_idx

    if [[ ! "$reciter_idx" =~ ^[0-9]+$ ]] || [[ $reciter_idx -lt 1 ]] || [[ $reciter_idx -ge $index ]]; then
        t invalid
        return 1
    fi

    local selected_reciter="${reciter_options[$reciter_idx]}"
    local selected_url="${reciters[$selected_reciter]}"

    # Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø±Ø§Ø¨Ø· Ù‚Ø¨Ù„ Ø§Ù„ØªØ´ØºÙŠÙ„
    if ! curl --output /dev/null --silent --head --fail "$selected_url"; then
        echo "âŒ Ø§Ù„Ø±Ø§Ø¨Ø· ØºÙŠØ± Ù…ØªØ§Ø­ Ø£Ùˆ Ù‡Ù†Ø§Ùƒ Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…"
        echo "ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù‚Ø§Ø±Ø¦ Ø¢Ø®Ø± Ø£Ùˆ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ù‹Ø§"
        return 1
    fi

    local surah_data=$(jq --argjson num "$sura_num" '.data.surahs[] | select(.number == $num)' "$QURAN_FILE" 2>/dev/null)
    if [[ -z "$surah_data" ]]; then
        echo "âŒ Ø§Ù„Ø³ÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©"
        return 1
    fi

    while true; do
        clear
        echo "ğŸ•Œ Ø³ÙˆØ±Ø© $(echo "$surah_data" | jq -r '.name')"
        echo "ğŸ™ï¸ Ø§Ù„Ù‚Ø§Ø±Ø¦: $selected_reciter"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo "1. $(t listen_only)"
        echo "2. $(t read_only)"
        echo "3. $(t read_listen)"
        echo "0. â†© $(t back)"
        echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        read -p "$(t choose_option)" play_mode

        case $play_mode in
            1)
                echo "â–¶ï¸ $(t playing)"
                play_audio "$selected_url"
                ;;
            2)
                read_full_surah "$surah_data"
                ;;
            3)
                play_with_text "$selected_url" "$surah_data"
                ;;
            0)
                return
                ;;
            *)
                t invalid
                sleep 1
                ;;
        esac
    done
}

play_audio() {
    local url="$1"
    if command -v "$PLAYER" &>/dev/null; then
        "$PLAYER" "$url" 2>/dev/null
    else
        echo "âŒ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø´ØºÙ„ Ø§Ù„ØµÙˆØª: $PLAYER"
        echo "ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ù„Ù…Ø´ØºÙ„ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª"
        return 1
    fi
}

play_with_text() {
    local url="$1"
    local surah_data="$2"

    # ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© ÙˆØªØ®Ø²ÙŠÙ† PID
    play_audio "$url" &
    local player_pid=$!

    # Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù„Ø­ÙŠÙ† ØªØ£ÙƒØ¯Ù†Ø§ Ù…Ù† Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
    sleep 6

    # Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø³Ù…Ù„Ø© ÙˆØ§Ù„Ø¹Ù†ÙˆØ§Ù†
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    t bismillah
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    # Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ§Øª ÙˆØ§Ø­Ø¯Ø© ØªÙ„Ùˆ Ø§Ù„Ø£Ø®Ø±Ù‰ Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù…Ù†Ø§Ø³Ø¨
    local verses=$(echo "$surah_data" | jq -r '.ayahs[] | "ï´¿ \(.text) ï´¾ (\(.numberInSurah))"')
    while IFS= read -r verse; do
        echo "$verse"
        echo ""

        local verse_length=$(echo "$verse" | wc -w)
        local delay=$(calculate_delay "$verse_length")
        sleep "$delay"
    done <<< "$verses"

    # Ø¨Ø¯Ù„Ù‹Ø§ Ù…Ù† Ù‚ØªÙ„ Ø§Ù„ØµÙˆØª ÙŠØ¯ÙˆÙŠÙ‹Ø§ØŒ Ù†Ù†ØªØ¸Ø± Ø­ØªÙ‰ ÙŠÙ†ØªÙ‡ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
    wait "$player_pid"
}

calculate_delay() {
    local length="$1"
    echo "scale=2; 1.5 + ($length / 5)" | bc
}

# ==============================================
# Ø§Ù„Ø£Ø°ÙƒØ§Ø±
# ==============================================

create_sample_azkar() {
    cat > "$AZKAR_FILE" << 'EOF'
{
  "categories": [
    {
      "name": "Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­",
      "items": [
        {
          "text": "Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù Ù…ÙÙ†Ù Ø§Ù„Ø´ÙÙ‘ÙŠÙ’Ø·ÙØ§Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø¬ÙÙŠÙ…Ù",
          "count": 3,
          "description": "Ø§Ù„Ø§Ø³ØªØ¹Ø§Ø°Ø© Ù…Ù† Ø§Ù„Ø´ÙŠØ·Ø§Ù†"
        },
        {
          "text": "Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ù„ÙØ§ ÙŠÙØ¶ÙØ±ÙÙ‘ Ù…ÙØ¹Ù Ø§Ø³Ù’Ù…ÙÙ‡Ù Ø´ÙÙŠÙ’Ø¡ÙŒ ÙÙÙŠ Ø§Ù„Ù’Ø£ÙØ±Ù’Ø¶Ù ÙˆÙÙ„ÙØ§ ÙÙÙŠ Ø§Ù„Ø³ÙÙ‘Ù…ÙØ§Ø¡Ù ÙˆÙÙ‡ÙÙˆÙ Ø§Ù„Ø³ÙÙ‘Ù…ÙÙŠØ¹Ù Ø§Ù„Ù’Ø¹ÙÙ„ÙÙŠÙ…Ù",
          "count": 3,
          "description": "Ø­ÙØ¸ Ù…Ù† ÙƒÙ„ Ø¶Ø±Ø±"
        },
        {
          "text": "Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù‡ÙÙˆÙ Ø§Ù„Ù’Ø­ÙÙŠÙÙ‘ Ø§Ù„Ù’Ù‚ÙÙŠÙÙ‘ÙˆÙ…Ù Ù„ÙØ§ ØªÙØ£Ù’Ø®ÙØ°ÙÙ‡Ù Ø³ÙÙ†ÙØ©ÙŒ ÙˆÙÙ„ÙØ§ Ù†ÙÙˆÙ’Ù…ÙŒ",
          "count": 1,
          "description": "Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ"
        }
      ]
    },
    {
      "name": "Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡",
      "items": [
        {
          "text": "Ø¢Ù…ÙÙ†Ù Ø§Ù„Ø±ÙÙ‘Ø³ÙÙˆÙ„Ù Ø¨ÙÙ…ÙØ§ Ø£ÙÙ†Ù’Ø²ÙÙ„Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù Ù…ÙÙ†Ù’ Ø±ÙØ¨ÙÙ‘Ù‡Ù ÙˆÙØ§Ù„Ù’Ù…ÙØ¤Ù’Ù…ÙÙ†ÙÙˆÙ†Ù",
          "count": 1,
          "description": "Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ"
        },
        {
          "text": "Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙØ­ÙØ¯ÙŒ",
          "count": 3,
          "description": "Ø³ÙˆØ±Ø© Ø§Ù„Ø¥Ø®Ù„Ø§Øµ"
        },
        {
          "text": "Ù‚ÙÙ„Ù’ Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙØ¨ÙÙ‘ Ø§Ù„Ù’ÙÙÙ„ÙÙ‚Ù",
          "count": 3,
          "description": "Ø³ÙˆØ±Ø© Ø§Ù„ÙÙ„Ù‚"
        }
      ]
    }
  ]
}
EOF
}

show_azkar() {
    if [[ ! -f "$AZKAR_FILE" ]]; then
        create_sample_azkar
    fi

    echo "ğŸ“¿ Ø£Ø°ÙƒØ§Ø± ÙˆØ£Ø¯Ø¹ÙŠØ© ÙŠÙˆÙ…ÙŠØ©:"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    jq -r '.categories[] | "ğŸ”¸ \(.name)\n\(.items[] | "\(.text)\n\(.description) - \(.count) Ù…Ø±Ø©\n")"' "$AZKAR_FILE" 2>/dev/null
}

# ==============================================
# Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØµÙ„Ø§Ø©
# ==============================================

prayer_times() {
    echo "ğŸ•‹ $(t loading_prayer_times)"

    local city="$DEFAULT_CITY"
    local country="$DEFAULT_COUNTRY"

    if [[ -z "$city" || -z "$country" ]]; then
        echo "ğŸ“ $(t location_not_set)"
        t enter_city
        read city
        t enter_country
        read country

        if [[ -z "$city" || -z "$country" ]]; then
            echo "âŒ $(t enter_city_country)"
            return 1
        fi

        DEFAULT_CITY="$city"
        DEFAULT_COUNTRY="$country"
        save_config
    fi

    # Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø¥Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† API
    get_method_number() {
        case "$1" in
            MWL) echo 3 ;;
            ISNA) echo 2 ;;
            Egypt) echo 5 ;;
            Makkah) echo 4 ;;
            Karachi) echo 1 ;;
            Tehran) echo 7 ;;
            Jafari) echo 8 ;;
            Morocco) echo 26 ;;
            Gulf) echo 9 ;;
            *) echo 2 ;; # Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© ISNA
        esac
    }

    # Ø¬Ù„Ø¨ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù† Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    local method_name=$(cat ~/.config/islamic-cli/method.conf 2>/dev/null || echo "MWL")
    local method=$(get_method_number "$method_name")

    if [[ -f "$PRAYER_CACHE" ]]; then
        local cache_time=$(stat -c %Y "$PRAYER_CACHE" 2>/dev/null || stat -f %m "$PRAYER_CACHE" 2>/dev/null || echo 0)
        local current_time=$(date +%s)
        local age=$((current_time - cache_time))

        if [[ $age -lt 21600 ]]; then
            echo "ğŸ•‹ $(t prayer_times_from_cache):"
            echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            if cat "$PRAYER_CACHE" 2>/dev/null | jq -r '
                "ğŸ“ $(t location): " + .city + ", " + .country,
                "ğŸ“ $(t method): " + .method,
                "ğŸŒ… $(t fajr): " + .fajr,
                "ğŸŒ $(t sunrise): " + .sunrise,
                "â˜€ï¸ $(t dhuhr): " + .dhuhr,
                "ğŸŒ‡ $(t asr): " + .asr,
                "ğŸŒ† $(t maghrib): " + .maghrib,
                "ğŸŒ™ $(t isha): " + .isha
            ' 2>/dev/null; then
                return 0
            else
                echo "âš ï¸ $(t cache_corrupted)"
                rm -f "$PRAYER_CACHE"
            fi
        fi
    fi

    echo "â³ $(t fetching_prayer_times)"

    city=$(echo "$city" | tr -d '\r\n' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')
    country=$(echo "$country" | tr -d '\r\n' | sed 's/^[[:space:]]*//;s/[[:space:]]*$//')

    local current_date=$(date +"%d-%m-%Y")
    local encoded_city=$(echo "$city" | sed 's/ /%20/g')
    local encoded_country=$(echo "$country" | sed 's/ /%20/g')
    local api_url="https://api.aladhan.com/v1/timingsByCity/${current_date}?city=${encoded_city}&country=${encoded_country}&method=${method}"

    echo "ğŸŒ $(t connecting_to) $api_url"

    local response=$(curl -s --connect-timeout 15 --max-time 30 "$api_url" 2>/dev/null)

    if [[ -z "$response" ]]; then
        echo "âŒ $(t no_server_response)"
        echo "ğŸ’¡ $(t check_internet)"
        return 1
    fi

    if ! echo "$response" | jq . >/dev/null 2>&1; then
        echo "âŒ $(t invalid_server_response)"
        return 1
    fi

    local status_code=$(echo "$response" | jq -r '.code // empty')
    if [[ "$status_code" != "200" ]]; then
        echo "âŒ $(t server_error) (Code: $status_code)"
        local error_msg=$(echo "$response" | jq -r '.data // .message // "Unknown error"')
        echo "$(t message): $error_msg"
        return 1
    fi

    local timings=$(echo "$response" | jq -r '.data.timings')
    if [[ "$timings" == "null" || -z "$timings" ]]; then
        echo "âŒ $(t no_prayer_times)"
        return 1
    fi

    local fajr=$(echo "$timings" | jq -r '.Fajr')
    local sunrise=$(echo "$timings" | jq -r '.Sunrise')
    local dhuhr=$(echo "$timings" | jq -r '.Dhuhr')
    local asr=$(echo "$timings" | jq -r '.Asr')
    local maghrib=$(echo "$timings" | jq -r '.Maghrib')
    local isha=$(echo "$timings" | jq -r '.Isha')

    jq -n \
        --arg city "$city" \
        --arg country "$country" \
        --arg method "$method_name" \
        --arg fajr "$fajr" \
        --arg sunrise "$sunrise" \
        --arg dhuhr "$dhuhr" \
        --arg asr "$asr" \
        --arg maghrib "$maghrib" \
        --arg isha "$isha" \
        --arg date "$(date '+%Y-%m-%d %H:%M:%S')" \
        '{
            city: $city,
            country: $country,
            method: $method,
            fajr: $fajr,
            sunrise: $sunrise,
            dhuhr: $dhuhr,
            asr: $asr,
            maghrib: $maghrib,
            isha: $isha,
            cached_at: $date
        }' > "$PRAYER_CACHE"

    echo "âœ… $(t prayer_times_fetched)"
    echo ""
    echo "ğŸ•‹ $(t prayer_times):"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
    echo "ğŸ“ $(t location): $city, $country"
    echo "ğŸ“ $(t method): $method_name"
    echo "ğŸŒ… $(t fajr): $fajr"
    echo "ğŸŒ $(t sunrise): $sunrise"
    echo "â˜€ï¸ $(t dhuhr): $dhuhr"
    echo "ğŸŒ‡ $(t asr): $asr"
    echo "ğŸŒ† $(t maghrib): $maghrib"
    echo "ğŸŒ™ $(t isha): $isha"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
}


# ==============================================
# Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
# ==============================================

get_location_info() {
    if [[ -f "$LOCATION_CACHE" ]]; then
        local cache_time=$(stat -c %Y "$LOCATION_CACHE" 2>/dev/null || stat -f %m "$LOCATION_CACHE" 2>/dev/null)
        local current_time=$(date +%s)
        local age=$((current_time - cache_time))

        if [[ $age -lt 86400 ]]; then
            echo "ğŸŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ (Ù…Ù† Ø§Ù„Ø®Ø¨ÙŠØ¦Ø©):"
            jq -r '. | "ğŸŒ Ø¹Ù†ÙˆØ§Ù† IP: \(.query)\nğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: \(.city)\nğŸŒ Ø§Ù„Ø¨Ù„Ø¯: \(.country)\nâ° Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©: \(.timezone)\nğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: \(.lat), \(.lon)"' "$LOCATION_CACHE"
            return 0
        fi
    fi

    t loading
    local location_data=$(curl -s --connect-timeout 10 "http://ip-api.com/json" 2>/dev/null)

    if [[ -n "$location_data" ]] && echo "$location_data" | jq -e . >/dev/null 2>&1; then
        echo "$location_data" > "$LOCATION_CACHE"
        echo "ğŸŒ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹:"
        jq -r '. | "ğŸŒ Ø¹Ù†ÙˆØ§Ù† IP: \(.query)\nğŸ™ï¸ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: \(.city)\nğŸŒ Ø§Ù„Ø¨Ù„Ø¯: \(.country)\nâ° Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø²Ù…Ù†ÙŠØ©: \(.timezone)\nğŸ“ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª: \(.lat), \(.lon)"' "$LOCATION_CACHE"
    else
        echo "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹"
        return 1
    fi
}
#Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø©
get_method_name() {
    local method_code="$1"
    case "$method_code" in
        "MWL") echo "Muslim World League" ;;
        "Egypt") echo "Egyptian General Authority" ;;
        "Makkah") echo "Umm Al-Qura, Makkah" ;;
        "Karachi") echo "University of Islamic Sciences, Karachi" ;;
        "Tehran") echo "Institute of Geophysics, University of Tehran" ;;
        "Gulf") echo "Gulf Region" ;;
        "Kuwait") echo "Kuwait" ;;
        "Qatar") echo "Qatar" ;;
        "Singapore") echo "Majlis Ugama Islam Singapura" ;;
        "Moonsighting") echo "Moonsighting Committee" ;;
        "ISNA") echo "Islamic Society of North America (ISNA)" ;;
        "Turkey") echo "Diyanet Ä°ÅŸleri BaÅŸkanlÄ±ÄŸÄ±, Turkey" ;;
        "Algeria") echo "Algerian Ministry of Religious Affairs" ;;
        "Tunisia") echo "Tunisian Ministry of Religious Affairs" ;;
        "Morocco") echo "Moroccan Ministry of Religious Affairs" ;;
        "Libya") echo "Libyan Ministry of Religious Affairs" ;;
        "UOIF") echo "Union Organization Islamic de France" ;;
        "FixedIsha90") echo "Fixed Isha (90 min after Maghrib)" ;;
        "FixedIsha120") echo "Fixed Isha (120 min after Maghrib)" ;;
        "EgyptSurvey") echo "Egyptian General Authority of Survey" ;;
        *) echo "$method_code" ;;
    esac
}
# ==============================================
# Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ
# ==============================================

hijri_date() {
    t loading
    local hijri_data=$(curl -s --connect-timeout 10 "http://api.aladhan.com/v1/gToH/$(date +%d-%m-%Y)" 2>/dev/null)

    if [[ -n "$hijri_data" ]] && echo "$hijri_data" | jq -e . >/dev/null 2>&1; then
        local hijri_date=$(echo "$hijri_data" | jq -r '.data.hijri')
        local gregorian_date=$(date +%d-%m-%Y)  # Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ

        if [[ "$hijri_date" != "null" ]]; then
            echo "ğŸ—“ï¸ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ:"
            echo "$hijri_date" | jq -r '"ğŸ“… \(.date) \(.month.ar) \(.year)Ù‡Ù€\nğŸŒ™ \(.weekday.ar)"'
            echo "âœ… Ù…ÙˆØ§ÙÙ‚ Ù„"
            echo "ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ: $gregorian_date"
        else
            echo "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ"
        fi
    else
        echo "âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ"
    fi
}


# ==============================================
# Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù†
# ==============================================

search_quran() {
    if [[ ! -f "$QURAN_FILE" ]]; then
        t no_data "$QURAN_FILE"
        return 1
    fi

    t search_term
    read search_term

    if [[ -z "$search_term" ]]; then
        echo "âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø¨Ø­Ø«"
        return 1
    fi

    t loading

    local results=$(jq --arg term "$search_term" '
        [
            .data.surahs[] as $surah |
            $surah.ayahs[] as $verse |
            if ($verse.text | contains($term)) then
                {
                    surah_number: $surah.number,
                    surah_name: $surah.name,
                    verse_number: $verse.numberInSurah,
                    text: $verse.text
                }
            else empty end
        ]
    ' "$QURAN_FILE" 2>/dev/null)

    local count=$(echo "$results" | jq 'length' 2>/dev/null)

    if [[ "$count" == "0" || "$count" == "null" ]]; then
        t no_results
        return 1
    fi

    t results_found "$count"
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    echo "$results" | jq -r '.[] | "ğŸ“– \(.surah_name) - Ø¢ÙŠØ© \(.verse_number)\nï´¿ \(.text) ï´¾\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"'
}

# ==============================================
# Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø³ÙˆØ±
# ==============================================

show_statistics() {
    if [[ ! -f "$QURAN_FILE" ]]; then
        t no_data "$QURAN_FILE"
        return 1
    fi

    t statistics
    echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

    local total_surahs=$(jq '.data.surahs | length' "$QURAN_FILE" 2>/dev/null)
    local total_verses=$(jq '[.data.surahs[].ayahs | length] | add' "$QURAN_FILE" 2>/dev/null)

    echo "ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©:"
    echo "ğŸ”¢ Ø¹Ø¯Ø¯ Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…ØªØ§Ø­Ø©: $total_surahs"
    echo "ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©: $total_verses"
    echo ""

    echo "ğŸ“– ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙˆØ±:"
    jq -r '.data.surahs[] | "ğŸ”¸ \(.name) (\(.englishName)) - \(.ayahs | length) Ø¢ÙŠØ©"' "$QURAN_FILE" 2>/dev/null

    echo ""
    t press_enter
    read
}

# ==============================================
# Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
# ==============================================

settings_menu() {
    while true; do
        clear
        t settings_menu
        echo ""
        t choose_option
        read choice

        case $choice in
            1) change_language ;;
            2) set_location ;;
            3) choose_calculation_method ;;
            4) change_player ;;
            5) clear_cache ;;
            0) break ;;
            *) t invalid ;;
        esac
    done
}

change_language() {
    t select_lang
    read new_lang

    case $new_lang in
        "ar"|"en")
            LANG="$new_lang"
            echo "LANG=\"$LANG\"" > "$LANG_FILE"
            t saved
            ;;
        *)
            t invalid
            ;;
    esac

    echo ""
    t press_enter
    read
}

set_location() {
    t enter_city
    read city
    t enter_country
    read country

    if [[ -n "$city" && -n "$country" ]]; then
        DEFAULT_CITY="$city"
        DEFAULT_COUNTRY="$country"
        save_config
        t saved
    else
        echo "âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙˆØ§Ù„Ø¨Ù„Ø¯"
    fi

    echo ""
    t press_enter
    read
}

choose_calculation_method() {
    while true; do
        clear
        echo "ğŸ“¿ $(t choose_method):"
        echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo -e "${CYAN}Ø§Ù„Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©:${NC}"
        echo "1) Muslim World League (MWL)"
        echo "2) Egyptian General Authority (Egypt)"
        echo "3) Umm Al-Qura University, Makkah (Makkah)"
        echo "4) University of Islamic Sciences, Karachi (Karachi)"
        echo "5) Institute of Geophysics, University of Tehran (Tehran)"

        echo -e "\n${CYAN}Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©:${NC}"
        echo "6) Gulf Region (Gulf)"
        echo "7) Kuwait (Kuwait)"
        echo "8) Qatar (Qatar)"
        echo "9) Majlis Ugama Islam Singapura (Singapore)"
        echo "10) Moonsighting Committee Worldwide (Moonsighting)"
        echo "11) North America (ISNA)"
        echo "12) Diyanet Ä°ÅŸleri BaÅŸkanlÄ±ÄŸÄ±, Turkey (Turkey)"

        echo -e "\n${CYAN}Ø·Ø±Ù‚ Ø´Ù…Ø§Ù„ Ø£ÙØ±ÙŠÙ‚ÙŠØ§:${NC}"
        echo "13) Algerian Ministry of Religious Affairs (Algeria)"
        echo "14) Tunisian Ministry of Religious Affairs (Tunisia)"
        echo "15) Moroccan Ministry of Religious Affairs (Morocco)"
        echo "16) Libyan Ministry of Religious Affairs (Libya)"

        echo -e "\n${CYAN}Ø·Ø±Ù‚ Ø£Ø®Ø±Ù‰:${NC}"
        echo "17) Union Organization Islamic de France (UOIF)"
        echo "18) Fixed Isha (90 min after Maghrib)"
        echo "19) Fixed Isha (120 min after Maghrib)"
        echo "20) Egyptian General Authority of Survey (EgyptSurvey)"

        echo -e "\n0) â†© $(t back)"
        echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

        read -p "$(t choose_option)" method_choice

        case $method_choice in
            1) method="MWL"; break ;;
            2) method="Egypt"; break ;;
            3) method="Makkah"; break ;;
            4) method="Karachi"; break ;;
            5) method="Tehran"; break ;;
            6) method="Gulf"; break ;;
            7) method="Kuwait"; break ;;
            8) method="Qatar"; break ;;
            9) method="Singapore"; break ;;
            10) method="Moonsighting"; break ;;
            11) method="ISNA"; break ;;
            12) method="Turkey"; break ;;
            13) method="Algeria"; break ;;
            14) method="Tunisia"; break ;;
            15) method="Morocco"; break ;;
            16) method="Libya"; break ;;
            17) method="UOIF"; break ;;
            18) method="FixedIsha90"; break ;;
            19) method="FixedIsha120"; break ;;
            20) method="EgyptSurvey"; break ;;
            0) return ;;
            *)
                echo "âŒ $(t invalid)"
                sleep 1
                ;;
        esac
    done

    # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    mkdir -p ~/.config/islamic-cli
    echo "$method" > ~/.config/islamic-cli/method.conf

    # Ø¹Ø±Ø¶ ØªØ£ÙƒÙŠØ¯ Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
    echo "âœ… $(t saved): $(get_method_name "$method")"

    echo ""
    t press_enter
    read
}

change_player() {
    t enter_player
    read player

    if command -v "$player" &>/dev/null; then
        PLAYER="$player"
        save_config
        t saved
    else
        echo "âŒ Ø§Ù„Ù…Ø´ØºÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯: $player"
    fi

    echo ""
    t press_enter
    read
}

clear_cache() {
    rm -f "$PRAYER_CACHE" "$LOCATION_CACHE"
    t cache_cleared

    echo ""
    t press_enter
    read
}

# ==============================================
# Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
# ==============================================

show_menu() {
    clear
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    t menu_title
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    t menu_options
    echo ""
    echo -e "${GREEN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
}

main_loop() {
    while true; do
        show_menu
        t choose_option
        read choice

        case $choice in
            1) read_quran ;;
            2) play_recitation ;;
            3) show_azkar ;;
            4) prayer_times ;;
            5) get_location_info ;;
            6) hijri_date ;;
            7) search_quran ;;
            8) show_statistics ;;
            9) settings_menu ;;
            0)
                echo ""
                t goodbye
                echo ""
                exit 0
                ;;
            *)
                t invalid
                ;;
        esac

        if [[ $choice != 9 ]]; then
            echo ""
            t press_enter
            read
        fi
    done
}

# ==============================================
# Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
# ==============================================

main() {
    # ÙØ­Øµ Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
    check_dependencies

    # ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    load_config

    # ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
    download_quran_data

    # Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬
    main_loop
}

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø¥Ø°Ø§ ØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©
if [[ "${BASH_SOURCE[0]}" == "${0}" ]]; then
    main "$@"
fi
